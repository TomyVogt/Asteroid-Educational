<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Asteroids – A–Z (Final)</title>
<style>
html,body{margin:0;height:100%;background:#05080f;color:#eaf1ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
#game{display:block;width:100vw;height:100vh;touch-action:none;}
.hud{position:fixed;top:10px;left:10px;right:10px;display:flex;gap:8px;justify-content:space-between;pointer-events:none;z-index:10;}
.pill{background:rgba(12,18,36,.6);border:1px solid rgba(120,160,255,.25);border-radius:999px;padding:6px 10px;font-weight:700;letter-spacing:.3px;text-shadow:0 0 8px #0a1430;}
.progress-wrap{position:fixed;left:10px;right:10px;bottom:10px;height:12px;border:1px solid rgba(120,160,255,.35);border-radius:999px;background:rgba(12,18,36,.6);z-index:10;display:flex;align-items:center;}
.progress-bar{height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg, rgba(120,160,255,.9), rgba(255,220,120,.95));transition:width .2s ease;}
.progress-text{position:absolute;width:100%;text-align:center;font-size:12px;font-weight:700;letter-spacing:.3px;pointer-events:none;color:#eaf1ff;mix-blend-mode:screen;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="hud">
  <div class="pill" id="hudScore">Punkte: 0</div>
  <div class="pill" id="hudNext">Nächster: A</div>
  <div class="pill" id="hudRemain">Übrig: 26</div>
  <div class="pill" id="hudUpcoming">Nächste: K, L, M, N, O</div>
</div>
<div class="progress-wrap">
  <div class="progress-bar" id="roundProgress"></div>
  <div class="progress-text" id="progressText">0 / 26</div>
</div>
<script>
(function(){
  const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
  const DPR=Math.max(1,Math.floor(window.devicePixelRatio||1));
  function resize(){const w=Math.floor(window.innerWidth),h=Math.floor(window.innerHeight);
    canvas.width=w*DPR; canvas.height=h*DPR; canvas.style.width=w+'px'; canvas.style.height=h+'px'; ctx.setTransform(DPR,0,0,DPR,0,0);
  } window.addEventListener('resize', resize); resize();

  // ====== Consts/Utils ======
  const TAU=Math.PI*2, FIELD_COUNT=10, AST_MIN=24, AST_MAX=60, FIRE_INTERVAL=180;
  const W=()=>canvas.width/DPR, H=()=>canvas.height/DPR;
  const rand=(a,b)=>Math.random()*(b-a)+a, wrap=(v,m)=>v<0?v+m:v%m, dist2=(x1,y1,x2,y2)=>{let dx=x2-x1,dy=y2-y1;return dx*dx+dy*dy;};
  const letters=Array.from({length:26},(_,i)=>String.fromCharCode(65+i)); // A..Z

  // ====== State ======
  const state={
    running:false,
    score:0,
    destroyedThisRound:0,          // 0..26
    asteroids:[], bullets:[], particles:[],
    ship:{x:0,y:0,angle:-Math.PI/2},
    firing:false, lastShot:0,
    inPlay:[],                      // letters currently on field
    sequence:[...letters],          // full A..Z
    seqIndex:FIELD_COUNT,           // next letter to introduce (starts at 10 for K)
    remaining:[...letters]          // not yet destroyed this round
  };

  // ====== HUD & Progress ======
  const elScore=document.getElementById('hudScore'),
        elNext=document.getElementById('hudNext'),
        elRemain=document.getElementById('hudRemain'),
        elUpcoming=document.getElementById('hudUpcoming'),
        progressEl=document.getElementById('roundProgress'),
        progressText=document.getElementById('progressText');

  function getLowest(){ return state.inPlay.slice().sort()[0]; }
  function HUD(){
    elScore.textContent = `Punkte: ${state.score}`;
    elNext.textContent  = `Nächster: ${state.inPlay.length?getLowest():""}`;
    elRemain.textContent= `Übrig: ${state.remaining.length}`;
    const nextSlice = state.sequence.slice(state.seqIndex, state.seqIndex+5);
    elUpcoming.textContent = `Nächste: ${nextSlice.join(', ')}`;
    updateProgress();
  }
  function updateProgress(){
    const pct = Math.max(0, Math.min(100, Math.round((state.destroyedThisRound/26)*100)));
    if(progressEl) progressEl.style.width = pct + '%';
    if(progressText) progressText.textContent = `${state.destroyedThisRound} / 26`;
  }

  // ====== Ship ======
  function centerShip(){ state.ship.x=W()/2; state.ship.y=H()/2; }

  // ====== Asteroids ======
  function poly(n,r){ const P=[]; for(let i=0;i<n;i++){ const a=i/n*TAU, rr=r*rand(.7,1.15); P.push({x:Math.cos(a)*rr,y:Math.sin(a)*rr}); } return P; }
  function spawnAsteroid(x,y,size,letter){
    const sp=rand(0.08,0.35), dir=rand(0,TAU), rot=rand(-0.01,0.01);
    const hue = Math.floor(Math.random()*360);
    const color = `hsl(${hue}, 70%, 65%)`; // random color per asteroid
    state.asteroids.push({ x,y, vx:Math.cos(dir)*sp, vy:Math.sin(dir)*sp, ang:rand(0,TAU), rot, size, letter, color, verts:poly(8+(Math.random()*4|0), size) });
  }

  // ====== Round setup ======
  function fillField(){
    state.asteroids.length=0; state.bullets.length=0; state.particles.length=0;
    state.inPlay=[]; state.remaining=[...letters]; state.sequence=[...letters];
    state.seqIndex = FIELD_COUNT;            // K next
    state.destroyedThisRound = 0;
    // place A..J
    for(let i=0;i<FIELD_COUNT;i++){
      const l = letters[i];
      state.inPlay.push(l);
      let x,y,tries=0;
      do{ x=Math.random()*W(); y=Math.random()*H(); tries++; }
      while(tries<600 && dist2(x,y,W()/2,H()/2) < 260*260);
      spawnAsteroid(x,y,rand(AST_MIN,AST_MAX), l);
    }
    HUD();
  }

  // ====== Bullets/FX ======
  function shoot(){
    const now=performance.now();
    if(now - state.lastShot < FIRE_INTERVAL) return;
    state.lastShot=now;
    const s=state.ship, sp=8;
    state.bullets.push({ x:s.x+Math.cos(s.angle)*16, y:s.y+Math.sin(s.angle)*16, vx:Math.cos(s.angle)*sp, vy:Math.sin(s.angle)*sp, life:60 });
  }
  function boom(x,y,c='#aef'){ for(let i=0;i<24;i++){ const a=rand(0,TAU), sp=rand(1,4); state.particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:40+(Math.random()*10|0),c}); } }

  // ====== Input (touch/mouse) ======
  canvas.addEventListener('touchstart', e=>{
    if(!state.running) return; centerShip();
    if(e.touches.length===2){ boom(state.ship.x,state.ship.y,'#6ff'); e.preventDefault(); return; }
    const t=e.touches[0]; if(!t) return;
    const rect=canvas.getBoundingClientRect(); const tx=t.clientX-rect.left, ty=t.clientY-rect.top;
    state.ship.angle = Math.atan2(ty - state.ship.y, tx - state.ship.x);
    state.firing=true; e.preventDefault();
  }, {passive:false});
  canvas.addEventListener('touchmove', e=>{
    if(!state.running) return;
    const t=e.touches[0]; if(!t) return;
    const rect=canvas.getBoundingClientRect(); const tx=t.clientX-rect.left, ty=t.clientY-rect.top;
    state.ship.angle = Math.atan2(ty - state.ship.y, tx - state.ship.x);
    state.firing=true; e.preventDefault();
  }, {passive:false});
  canvas.addEventListener('touchend', ()=>{ state.firing=false; }, {passive:false});
  canvas.addEventListener('touchcancel', ()=>{ state.firing=false; }, {passive:false});
  let mouseDown=false;
  canvas.addEventListener('mousedown', e=>{
    mouseDown=true; centerShip();
    const rect=canvas.getBoundingClientRect(); const mx=e.clientX-rect.left, my=e.clientY-rect.top;
    state.ship.angle = Math.atan2(my - state.ship.y, mx - state.ship.x);
    state.firing=true;
  });
  window.addEventListener('mouseup', ()=>{ mouseDown=false; state.firing=false; });
  canvas.addEventListener('mousemove', e=>{
    if(!mouseDown) return;
    const rect=canvas.getBoundingClientRect(); const mx=e.clientX-rect.left, my=e.clientY-rect.top;
    state.ship.angle = Math.atan2(my - state.ship.y, mx - state.ship.x);
  });

  // ====== Update ======
  function update(){
    centerShip();
    if(state.firing) shoot();

    // bullets
    for(let i=state.bullets.length-1;i>=0;i--){
      const b=state.bullets[i];
      b.x+=b.vx; b.y+=b.vy;
      b.x=wrap(b.x,W()); b.y=wrap(b.y,H());
      if(--b.life<=0) state.bullets.splice(i,1);
    }
    // asteroids
    for(const a of state.asteroids){ a.x=wrap(a.x+a.vx,W()); a.y=wrap(a.y+a.vy,H()); a.ang += a.rot; }
    // repulsion
    for(const a of state.asteroids){
      const dx=a.x-state.ship.x, dy=a.y-state.ship.y, minDist=a.size+26, d2=dx*dx+dy*dy;
      if(d2<minDist*minDist){ const d=Math.max(0.001,Math.sqrt(d2)), ux=dx/d, uy=dy/d, push=(minDist-d)*0.45;
        a.x=wrap(a.x+ux*push,W()); a.y=wrap(a.y+uy*push,H()); a.vx+=ux*0.02; a.vy+=uy*0.02; }
    }
    // hits
    const lowest = getLowest();
    outer: for(let i=state.asteroids.length-1;i>=0;i--){
      const a=state.asteroids[i];
      for(let j=state.bullets.length-1;j>=0;j--){
        const b=state.bullets[j];
        if(dist2(a.x,a.y,b.x,b.y) < (a.size*a.size)){
          state.bullets.splice(j,1);
          if(a.letter === lowest){
            // correct
            state.score += 10;
            state.destroyedThisRound++;
            state.inPlay = state.inPlay.filter(l=>l!==a.letter);
            state.remaining = state.remaining.filter(l=>l!==a.letter);
            boom(a.x,a.y);
            state.asteroids.splice(i,1);
            // introduce next letter if sequence not exhausted
            if(state.seqIndex < state.sequence.length){
              const l = state.sequence[state.seqIndex++];
              state.inPlay.push(l);
              spawnAsteroid(Math.random()*W(), Math.random()*H(), rand(AST_MIN,AST_MAX), l);
            } else {
              // sequence exhausted: no spawn; count drops
            }
            // end of round?
            if(state.destroyedThisRound >= 26 || state.inPlay.length === 0){
              fillField(); // immediate restart
            }
            HUD();
          } else {
            // wrong: sparkle only
            boom(a.x,a.y,'#6aa8ff');
          }
          break outer;
        }
      }
    }
    // particles
    for(let i=state.particles.length-1;i>=0;i--){
      const p=state.particles[i]; p.x+=p.vx; p.y+=p.vy; p.vx*=0.99; p.vy*=0.99; if(--p.life<=0) state.particles.splice(i,1);
    }
  }

  // ====== Draw ======
  const stars=Array.from({length:120},()=>({x:Math.random(),y:Math.random(),r:Math.random()*1.5+0.5,tw:Math.random()*TAU}));
  function drawStars(){ const w=W(),h=H(); for(const s of stars){ const a=0.5+Math.sin(s.tw+=0.02)*0.2; ctx.globalAlpha=a; ctx.fillStyle='#bcd9ff'; ctx.fillRect(s.x*w,s.y*h,s.r,s.r); ctx.globalAlpha=1; } }
  function drawShip(s){ ctx.save(); ctx.translate(s.x,s.y); ctx.rotate(s.angle); ctx.lineWidth=2; ctx.strokeStyle='#9fe'; ctx.beginPath(); ctx.moveTo(14,0); ctx.lineTo(-10,-10); ctx.lineTo(-6,-6); ctx.lineTo(-6,6); ctx.lineTo(-10,10); ctx.closePath(); ctx.stroke(); ctx.restore(); }
  function drawAsteroid(a, glowFactor){
    ctx.save();
    ctx.translate(a.x,a.y); ctx.rotate(a.ang);
    if(glowFactor){
      const speed = glowFactor>1 ? 120 : 200; // faster when only one left
      const pulse = 6*glowFactor + Math.sin(performance.now()/speed)*4*glowFactor;
      ctx.shadowColor = '#ffd54a'; ctx.shadowBlur = 22*glowFactor;
      ctx.strokeStyle = '#ffd54a'; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.arc(0,0,a.size + pulse, 0, TAU); ctx.stroke();
    }
    ctx.strokeStyle = a.color || '#b9cfff'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(a.verts[0].x,a.verts[0].y);
    for(let i=1;i<a.verts.length;i++) ctx.lineTo(a.verts[i].x,a.verts[i].y);
    ctx.closePath(); ctx.stroke();
    ctx.fillStyle='#eaf1ff'; ctx.font='bold 16px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(a.letter, 0, 0);
    ctx.restore();
  }
  function draw(){
    ctx.clearRect(0,0,W(),H()); drawStars();
    const lowest = getLowest();
    const finalPhase = state.asteroids.length === 1;
    for(const a of state.asteroids){
      const gf = (a.letter===lowest) ? (finalPhase ? 1.8 : 1.0) : 0;
      drawAsteroid(a, gf);
    }
    for(const b of state.bullets){ ctx.beginPath(); ctx.arc(b.x,b.y,2,0,TAU); ctx.fillStyle='#e6f1ff'; ctx.fill(); }
    for(const p of state.particles){ ctx.globalAlpha=Math.max(0,p.life/40); ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,2,2); ctx.globalAlpha=1; }
    drawShip(state.ship);
  }

  function tick(){ if(!state.running) return; update(); draw(); requestAnimationFrame(tick); }

  // ====== Start ======
  function startGame(){ state.score=0; centerShip(); fillField(); state.running=true; tick(); }
  startGame();
})();
</script>
</body>
</html>
